# klaus-delegation.conf - Tunable complexity scoring
# Edit this file to adjust routing behavior

# === MODE ===
SMART_DELEGATE_MODE="ON"    # ON | OFF
MIN_LENGTH=30               # Minimum prompt length

# === TIER THRESHOLDS ===
# Score 0-2 = DIRECT (no agents)
# Score 3-4 = LIGHT (explore-light only)
# Score 5-6 = MEDIUM (explore-light + research-light + plan-orchestrator)
# Score 7+  = FULL (explore-lead + research-lead + plan-orchestrator)
# [!] Aligned with balanced profile default (2026-01-27)
#     TIER_FULL_MIN=7 matches balanced profile for consistency
#     Profiles can override these thresholds as needed
TIER_LIGHT_MIN=3
TIER_MEDIUM_MIN=5
TIER_FULL_MIN=7

# === LENGTH SCORING ===
LENGTH_100_SCORE=1          # +N if prompt > 100 chars
LENGTH_200_SCORE=1          # +N if prompt > 200 chars
LENGTH_400_SCORE=2          # +N if prompt > 400 chars

# === COMPLEXITY KEYWORDS (increase score) ===
# Format: "regex_pattern:weight"
# [!] Calibrated weights based on E2E test results (2026-01-26)
COMPLEX_KEYWORDS=(
  "system:1"                                         # Split from compound pattern for multi-match
  "architecture:1"                                   # Split from compound pattern for multi-match
  "design:1"                                         # Split from compound pattern for multi-match
  "integrate:2"                                      # Integration work is moderately complex
  "across|multiple|all files|every|codebase:1"       # Multi-file work
  "best practice|documentation|research|how to:2"    # Research baseline
  "refactor|restructure|redesign:3"                  # Increased to 3 for MEDIUM threshold
  "security|authentication|authorization:1"          # Co-occurs frequently
  "investigate|deep dive|thorough analysis:2"        # Investigation work
  "compare.*versus|compare.*with:3"                  # Comparison work is complex
  "set up tests|test infrastructure:3"               # Infrastructure work is complex
  "initialize project|scaffold|bootstrap:3"          # Project setup is complex
  "oauth|authentication.*provider|authorization:1"   # Overlaps with authentication
  "database migration|schema changes:3"              # Database work is complex
  "api integration|rest|graphql:1"                   # API work common
  "docker|containerization|deployment:2"             # Deployment work
  "ci/cd|github actions|pipeline:2"                  # CI/CD work
  "benchmark|performance.*analysis:3"                # Performance analysis
  "and.*also|as well as|plus|additionally:1"        # Multi-clause indicator
  "not only.*but also|both.*and:2"                   # Complex multi-clause
  "comprehensive|extensive:3"                        # High-complexity scope indicators (increased for FULL tier)
  "thorough:1"                                       # Split out (less strong than comprehensive)
  "implementation:2"                                 # Noun form - actual implementation work
  "implement:1"                                      # Verb form - could be "research how to implement"
  "build out:1"                                      # Build/construction work
  "error.?handling|exception|validation:1"           # Error handling
  "performance|optimize|optimization:2"              # Performance work indicators
  "propose|strategy|approach|plan:1"                 # Planning work indicators (reduced to avoid over-scoring "implementation plan")
  "improve|enhance|upgrade:1"                        # Enhancement work
)
# === SIMPLE KEYWORDS (decrease score) ===
# Format: "regex_pattern:weight"
# [!] Calibrated based on E2E test results (2026-01-26)
SIMPLE_KEYWORDS=(
  "fix typo|add comment|rename|update:4"
  "simple|quick|small|minor:3"
  "this file|this function|this line:2"
  "just|only|simply:2"
  "straightforward|basic|elementary:2"
  "single file|this specific|that specific:3"
  "skip.*research|no need to.*:2"
  "what is|where is|how do i|show me:2"
  # Removed "explain|describe|clarify" - these don't always indicate simplicity
  # e.g., "investigate and explain" is research work, not simple
)

# === CONTEXT7 / DOCUMENTATION KEYWORDS (increase score) ===
# These patterns trigger documentation and library research workflows
# Format: "regex_pattern:weight"
CONTEXT7_KEYWORDS=(
  "how to use|how do i use|using:3"
  "documentation|docs|api reference:4"
  "library|package|framework|sdk:3"
  "npm package|pip install|gem install|cargo add:4"
  "import.*from|require\(|use.*library:3"
  "authenticate.*with|integrate.*with:3"
  "setup|configure|initialize:2"
  "code example|sample code|usage example|snippet:4"
  "react|vue|angular|svelte|next\.?js|nuxt:3"
  "express|fastify|koa|django|flask|rails:3"
  "typescript|javascript|python|rust|go lang:2"
  "graphql|rest api|openapi|swagger:3"
  "prisma|sequelize|mongoose|typeorm|drizzle:3"
  "mongodb|postgres|mysql|redis|sqlite:2"
  "aws|azure|gcp|vercel|netlify|cloudflare:2"
  "oauth|jwt|auth0|clerk|supabase auth:3"
  "stripe|payment.*api|checkout|billing:3"
  "webhooks|websockets|sse|server.*sent:3"
  "tailwind|chakra|shadcn|material.*ui:2"
  "vite|webpack|rollup|esbuild|turbopack:2"
)

# === CONTEXT7 CONFIGURATION ===
ENABLE_CONTEXT7_DETECTION="ON"  # ON | OFF - Enable Context7 keyword detection
CONTEXT7_SCORE_THRESHOLD=3       # Min Context7 score to trigger boost
CONTEXT7_SCORE_BOOST=1           # Score boost when Context7 relevant (reduced from 2 to prevent over-inflation)

# === ROUTING TRANSPARENCY ===
ROUTING_EXPLANATION="ON"         # ON | OFF - Show routing rationale to user

# === ASYNC HOOK CONFIGURATION ===
ENABLE_ASYNC_HOOKS="OFF"          # ON | OFF - Enable async hook execution (Phase 1)
ASYNC_TIMEOUT=5000                 # Max wait for background analysis (ms)
ASYNC_SESSION_TTL=86400            # Session state lifetime (24 hours in seconds)
ASYNC_DEBUG_MODE="OFF"             # Enable async-specific debug logging
ASYNC_DEBUG_LOG="${HOME}/.claude/async-delegate.log"

# === TELEMETRY (B1 - Routing Outcome Tracking) ===
ENABLE_ROUTING_HISTORY="OFF"       # OFF by default, opt-in only (privacy-first)
ROUTING_HISTORY_FILE="${HOME}/.claude/telemetry/routing-history.jsonl"
ROUTING_HISTORY_SANITIZE="ON"      # ON = hash prompts, OFF = store plaintext (not recommended)

# === CI/CD INTEGRATION (Phase 1, Week 4 - OPTIONAL) ===
ENABLE_GITHUB_ACTIONS="OFF"        # OFF by default, opt-in via setup-github-actions.sh
                                   # ON = workflows enabled in .github/workflows/
                                   # OFF = workflows remain as templates in .github-workflows-templates/
                                   # Note: This flag documents preference, actual workflows enabled by setup script

# === DEBUG ===
DEBUG_MODE="OFF"            # ON = log to file
DEBUG_LOG="${HOME}/.claude/smart-delegate.log"
CONTEXT7_DEBUG_LOG="${HOME}/.claude/context7-delegate.log"

# === NEW AGENT FLAGS ===
ENABLE_WEB_RESEARCHER="OFF"       # web-research-specialist agent
ENABLE_DOCS_SPECIALIST="ON"       # docs-specialist agent (haiku model, available in all tiers)
ENABLE_TEST_INFRASTRUCTURE="OFF"  # test-infrastructure-agent
ENABLE_FILE_PATH_EXTRACTOR="ON"   # file-path-extractor agent (default ON)
ENABLE_REMINDER_SYSTEM="OFF"      # reminder-nudger-agent
ENABLE_SUB_DELEGATION="OFF"       # sub-delegation capability

# === SUB_DELEGATION LIMITS ===
MAX_DELEGATION_DEPTH=3
MAX_SUBAGENTS_PER_LEAD=20
SUBAGENT_TOOL_CALL_LIMIT=20

# === REMINDER SYSTEM ===
REMINDER_STAGNATION_TIMEOUT=120
REMINDER_TOOL_CALL_THRESHOLD=15
REMINDER_ESCALATION_LEVELS=4