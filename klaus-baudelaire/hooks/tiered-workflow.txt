TIERED IMPLEMENTATION PIPELINE ({{TIER}} MODE)

CURRENT TIER: {{TIER}}

[!] ARCHITECTURE NOTE: MEDIUM/FULL sections below are DOCUMENTATION ONLY.
    klaus-delegation.sh intercepts MEDIUM/FULL tiers and builds custom
    additionalContext with plan-orchestrator instructions (lines 441-522).
    These sections are NEVER injected but serve as workflow reference.

    ONLY LIGHT tier uses this file for context injection.

═══════════════════════════════
IF {{TIER}} = LIGHT → PHASE 1-LIGHT (injected by hook)
IF {{TIER}} = MEDIUM → plan-orchestrator invoked (custom context from hook)
IF {{TIER}} = FULL → plan-orchestrator invoked (custom context from hook)
═══════════════════════════════

PHASE 1-LIGHT: Quick Context
═══════════════════════════════
Primary agent: @"explore-light (agent)"
  → HAS Context7 resolve-library-id for library identification

Optional agents (feature-flagged):
• @"web-research-specialist (agent)" [if ENABLE_WEB_RESEARCHER=ON]
  → HAS Context7 tools for library/API documentation
• @"docs-specialist (agent)" [if ENABLE_DOCS_SPECIALIST=ON, default ON]
  → Fetches from official sources ONLY (developer.apple.com, not forums)
  → HAS Context7 tools, WebSearch, WebFetch, haiku model for speed

Then proceed to IMPLEMENTATION.

PHASE 1-MEDIUM: Light Intelligence
═══════════════════════════════
Launch in parallel:
• @"explore-light (agent)"
  → HAS Context7 resolve-library-id for library identification
• @"research-light (agent)" if needed
  → HAS Context7 resolve-library-id for quick library lookups
  → Validates docs-specialist findings, does NOT search for documentation
• @"docs-specialist (agent)" [PRIMARY for ALL documentation needs]
  → Fetches from official sources ONLY (docs.python.org, react.dev, not blogs)
  → HAS Context7 tools, WebSearch, WebFetch, haiku model for speed
• @"file-path-extractor (agent)" [on bash command output]

Then @"plan-orchestrator (agent)" → IMPLEMENTATION.

PHASE 1-FULL: Full Intelligence
═══════════════════════════════
[!!!] DOCUMENTATION DELEGATION PROTOCOL [!!!]
For ANY documentation needs, follow 2-attempt validation:
  [Attempt 1] docs-specialist fetches → research-lead validates
  [Attempt 2] docs-specialist refines → research-lead re-validates
  [Escalation] Only after 2 failures does research-lead search web

Launch in parallel:
• @"explore-lead (agent)"
• @"docs-specialist (agent)" [PRIMARY for ALL documentation - called FIRST]
  → Fetches from official sources ONLY (developer.apple.com, swift.org, not forums)
  → HAS Context7 tools, WebSearch, WebFetch, haiku model for speed
  → Returns findings to research-lead for validation
• @"research-lead (agent)"
  → Validates docs-specialist findings (quality, completeness, official source)
  → Does NOT search for documentation unless 2 doc-specialist attempts fail
  → HAS full Context7 suite, delegates non-doc research to subagents
• @"web-research-specialist (agent)"
  → HAS Context7 tools for library/API documentation
• @"file-path-extractor (agent)" [on bash output]

Then @"plan-orchestrator (agent)" → TASK PLANNING → IMPLEMENTATION.

═══════════════════════════════
TASK PLANNING (all tiers)
═══════════════════════════════
[0] Create task breakdown using TaskCreate
    • Structure work as discrete, trackable tasks
    • Subject: Imperative verb + outcome ("Implement OAuth middleware")
    • Description: Detailed context, acceptance criteria, file paths
    • ActiveForm: Present continuous ("Implementing OAuth middleware")
    • Update tasks to in_progress when starting work
    • Mark completed when done

═══════════════════════════════
IMPLEMENTATION (all tiers)
═══════════════════════════════
[1] IMPLEMENTATION: Edit/Write → follow plan
    • Check TaskList before starting
    • Update relevant tasks to in_progress
    • Mark completed when done
[2] VERIFICATION: Run tests → fix (max 3)
[3] DELIVERY: Summarize changes, results

[NEW] SPECIALIZED AGENTS (Optional):
═══════════════════════════════
• @"docs-specialist" [PRIMARY documentation gatherer - ALL TIERS including DIRECT]
  → Called FIRST for libraries, frameworks, APIs, packages, SDKs
  → Fetches ONLY from official sources (tier 1: developer.apple.com, docs.python.org)
  → Returns findings to research agents for validation, does NOT delegate
  → HAS Context7 tools (resolve-library-id, query-docs), WebSearch, WebFetch, haiku model
• @"web-research-specialist" [for non-documentation web research]
  → Validates docs-specialist findings, does NOT search for documentation
  → HAS Context7 tools for library/API documentation
• @"file-path-extractor" [to extract file paths from bash output]
• @"code-simplifier" [after code changes for refactoring]
  → HAS Context7 tools for library best practices lookup
• @"test-infrastructure-agent" [when setting up tests or test infrastructure]
  → HAS Context7 tools for test framework documentation
• @"explore-light" [quick codebase exploration]
  → HAS Context7 resolve-library-id for library identification
• @"reminder-nudger-agent" [for progress monitoring and strategic guidance]

Execute autonomously. Max 3 test fix attempts.
